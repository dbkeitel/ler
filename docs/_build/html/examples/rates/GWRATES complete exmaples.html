<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GWRATES complete exmaples &mdash; ler 0.3.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=4621528c"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Calculation of detectable Gamma ray burst (GRB) event rate associated with Binary Neutron Star (BNS) mergers." href="grb%20detection%20rate.html" />
    <link rel="prev" title="LeR complete examples" href="LeR%20complete%20examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ler
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Installation2.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Summary.html">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_overview.html">Code overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GW_events.html">Gravitational wave event rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GW_equations.html">Gravitational wave events sampling (Analytical formulation)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Lensed_events.html">Lensed event rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Lensed_equations.html">Lensed event sampling (Analytical formulation)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/rates/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.rates</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/gw_source_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.gw_source_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/lens_galaxy_population/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.lens_galaxy_population</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/image_properties/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.image_properties</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autoapi/ler/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ler.utils</span></code></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="LeR%20complete%20examples.html">LeR complete examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">GWRATES complete exmaples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Short-BBH-(Binary-Black-Hole)-example-with-three-detectors">Short BBH (Binary Black Hole) example with three detectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Custom-functions">Custom functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#How-to-look-for-available-model-functions?">How to look for available model functions?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Using-internal-model-functions">Using internal model functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Mass-distribution-of-BBH-(mass-1,-larger-mass-only)">Mass distribution of BBH (mass-1, larger mass only)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Selecting-particular-number-of-detectable-events">Selecting particular number of detectable events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Utilizing-the-ANN-feature-of-the-gwsnr">Utilizing the ANN feature of the <code class="docutils literal notranslate"><span class="pre">gwsnr</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#BNS-(Binary-Neutron-Star)-example">BNS (Binary Neutron Star) example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-custom-detection-criteria">Using custom detection criteria</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="grb%20detection%20rate.html">Calculation of detectable Gamma ray burst (GRB) event rate associated with Binary Neutron Star (BNS) mergers.</a></li>
<li class="toctree-l1"><a class="reference internal" href="ler%20bns%20example.html">LeR complete examples of BNS events (O4 design sensitivity)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rates_with_3G_detectors.html">Event Rates with 3G detectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/merger%20rate%20density%20evolution%20with%20redshift.html">Merger rate density evolution with redshift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/merger%20rate%20density%20model%20comparision.html">Merger rate density model comparision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/merger%20rate%20density%20model%20comparision.html#Primordial-BBH-model,-Ng-et-al.-2022">Primordial BBH model, Ng et al. 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/sample%20compact%20binary%20parameters.html">Sampling parameters for a compact binary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/statistical%20study%20of%20changing%20mass%20model%20params.html">Statistical study of changing Mass model paramter(s)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source%20population/statistical%20study%20of%20cosmological%20friction.html">Statistical study of cosmological friction and its effect on the redshift vs inferred chirp-mass relation of gravitational waves</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lens_parameters/sample%20lens%20parameters.html">Lens parameter distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optical_depth/validation_SIE.html">Optical depth SIE model validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optical_depth/validation_SIS.html">Validation of SIS model (Numerical vs Analytical)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../image_properties/dt_vs_dmu.html">Study of Time delays and magnification of lensed gravitational waves.</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ler</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">GWRATES complete exmaples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/rates/GWRATES complete exmaples.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="GWRATES-complete-exmaples">
<h1>GWRATES complete exmaples<a class="headerlink" href="#GWRATES-complete-exmaples" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p>Please refer to the <a class="reference external" href="https://ler.readthedocs.io/en/latest/">documentation</a> for more details.</p></li>
</ul>
<section id="Short-BBH-(Binary-Black-Hole)-example-with-three-detectors">
<h2>Short BBH (Binary Black Hole) example with three detectors<a class="headerlink" href="#Short-BBH-(Binary-Black-Hole)-example-with-three-detectors" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>This part of the notebook is a short example to simulate a binary black hole mergers and calculate its rate (<span class="math notranslate nohighlight">\(yr^{-1}\)</span>).</p></li>
<li><p>All generated data is saved in the <code class="docutils literal notranslate"><span class="pre">ler_data</span></code> folder.</p></li>
<li><p>All interpolation data is saved in the <code class="docutils literal notranslate"><span class="pre">interpolator_pickle</span></code> folder.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># call the GWRATES class</span>
<span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">GWRATES</span>
</pre></div>
</div>
</div>
<ul>
<li><p>class initialization</p></li>
<li><p>if you want the models and its parameters to print.</p>
<p><code class="docutils literal notranslate"><span class="pre">ler</span> <span class="pre">=</span> <span class="pre">GWRATES()</span></code></p>
</li>
<li><p>set ‘npool’ according to your machine’s available CPU cores. Default is 4.</p></li>
<li><p>to check no. of cores,</p>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">multiprocessing</span> <span class="pre">as</span> <span class="pre">mp</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">print(mp.cpu_count())</span></code></p>
</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span> <span class="o">=</span> <span class="n">GWRATES</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">create_new_interpolator</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>simulation of the GW CBC population</p></li>
<li><p>this will generate a json file with the simulated population parameters</p></li>
<li><p>by default 100,000 events will be sampled with batches of 50,000.</p></li>
<li><p>results will be saved in the same directory as json file.</p></li>
<li><p>resume=True will resume the simulation from the last saved batch.</p></li>
<li><p>if you need to save the file at the end of each batch sampling, set save_batch=True.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulated GW params will be stored in ./ler_data/gw_param.json
chosen batch size = 50000 with total size = 100000
There will be 2 batche(s)
Batch no. 1
sampling gw source params...
calculating snrs...
Batch no. 2
sampling gw source params...
calculating snrs...
saving all gw_params in ./ler_data/gw_param.json...
</pre></div></div>
</div>
<ul class="simple">
<li><p>generate detectable events</p></li>
<li><p>note: here no input param is provided, so it will track the json file generated above</p></li>
<li><p>final rate is the rate of detectable events</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rate</span><span class="p">,</span> <span class="n">param_detectable</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_rate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
getting gw_params from json file ./ler_data/gw_param.json...
total gw rate (yr^-1) (with step function): 434.79616560249093
number of simulated gw detectable events: 420
number of all simulated gw events: 100000
storing detectable gw params in ./ler_data/gw_param.json
</pre></div></div>
</div>
<ul class="simple">
<li><p>look for available parameters</p></li>
<li><p><strong>Note:</strong> This is for spin-less systems.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_detectable</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;, &#39;optimal_snr_net&#39;])
</pre></div></div>
</div>
<ul class="simple">
<li><p>all gwrates initialization parameters, simulated parameters’s json file names and rate results are strored as json file in the <code class="docutils literal notranslate"><span class="pre">ler_data</span></code> directory by default.</p></li>
<li><p>Now, let’s see all the LeR class initialization parameters. This is either get from the json file ‘.ler_data/gwrates_params.json’ or from the ler object.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># what are the saved files?</span>
<span class="n">ler</span><span class="o">.</span><span class="n">json_file_names</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;gwrates_param&#39;: &#39;gwrates_params.json&#39;,
 &#39;gw_param&#39;: &#39;gw_param.json&#39;,
 &#39;gw_param_detectable&#39;: &#39;gw_param_detectable.json&#39;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let me introduce two of the most use function in ler</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">load_json</span><span class="p">,</span> <span class="n">append_json</span>
<span class="n">ler_params</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="s1">&#39;ler_data/gwrates_params.json&#39;</span><span class="p">)</span>
<span class="c1"># ler_params = ler.gw_param_sampler_dict  # if you want to get it as an object</span>
<span class="n">ler_params</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;npool&#39;: &#39;4&#39;,
 &#39;z_min&#39;: &#39;0.0&#39;,
 &#39;z_max&#39;: &#39;10.0&#39;,
 &#39;size&#39;: &#39;100000&#39;,
 &#39;batch_size&#39;: &#39;50000&#39;,
 &#39;cosmology&#39;: &#39;LambdaCDM(H0=70.0 km / (Mpc s), Om0=0.3, Ode0=0.7, Tcmb0=0.0 K, Neff=3.04, m_nu=None, Ob0=None)&#39;,
 &#39;snr_finder&#39;: &#39;&lt;bound method GWSNR.snr of &lt;gwsnr.gwsnr.GWSNR object at 0x29cb6e680&gt;&gt;&#39;,
 &#39;json_file_names&#39;: &#34;{&#39;gwrates_param&#39;: &#39;gwrates_params.json&#39;, &#39;gw_param&#39;: &#39;gw_param.json&#39;, &#39;gw_param_detectable&#39;: &#39;gw_param_detectable.json&#39;}&#34;,
 &#39;interpolator_directory&#39;: &#39;./interpolator_pickle&#39;,
 &#39;gw_param_sampler_dict&#39;: {&#39;z_min&#39;: &#39;0.0&#39;,
  &#39;z_max&#39;: &#39;10.0&#39;,
  &#39;event_type&#39;: &#39;BBH&#39;,
  &#39;source_priors&#39;: &#34;{&#39;merger_rate_density&#39;: &#39;merger_rate_density_bbh_popI_II_oguri2018&#39;, &#39;source_frame_masses&#39;: &#39;binary_masses_BBH_popI_II_powerlaw_gaussian&#39;, &#39;zs&#39;: &#39;sample_source_redshift&#39;, &#39;geocent_time&#39;: &#39;sampler_uniform&#39;, &#39;ra&#39;: &#39;sampler_uniform&#39;, &#39;dec&#39;: &#39;sampler_cosine&#39;, &#39;phase&#39;: &#39;sampler_uniform&#39;, &#39;psi&#39;: &#39;sampler_uniform&#39;, &#39;theta_jn&#39;: &#39;sampler_sine&#39;}&#34;,
  &#39;source_priors_params&#39;: &#34;{&#39;merger_rate_density&#39;: {&#39;R0&#39;: 2.39e-08, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}, &#39;source_frame_masses&#39;: {&#39;mminbh&#39;: 4.98, &#39;mmaxbh&#39;: 112.5, &#39;alpha&#39;: 3.78, &#39;mu_g&#39;: 32.27, &#39;sigma_g&#39;: 3.88, &#39;lambda_peak&#39;: 0.03, &#39;delta_m&#39;: 4.8, &#39;beta&#39;: 0.81}, &#39;zs&#39;: None, &#39;geocent_time&#39;: {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}, &#39;ra&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;dec&#39;: None, &#39;phase&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;psi&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}, &#39;theta_jn&#39;: None}&#34;,
  &#39;cosmology&#39;: &#39;LambdaCDM(H0=70.0 km / (Mpc s), Om0=0.3, Ode0=0.7, Tcmb0=0.0 K, Neff=3.04, m_nu=None, Ob0=None)&#39;,
  &#39;spin_zero&#39;: &#39;True&#39;,
  &#39;spin_precession&#39;: &#39;False&#39;,
  &#39;interpolator_directory&#39;: &#39;./interpolator_pickle&#39;,
  &#39;create_new_interpolator&#39;: &#39;False&#39;},
 &#39;snr_calculator_dict&#39;: {&#39;npool&#39;: &#39;4&#39;,
  &#39;mtot_min&#39;: &#39;2.0&#39;,
  &#39;mtot_max&#39;: &#39;184.98599853446768&#39;,
  &#39;ratio_min&#39;: &#39;0.1&#39;,
  &#39;ratio_max&#39;: &#39;1.0&#39;,
  &#39;mtot_resolution&#39;: &#39;500&#39;,
  &#39;ratio_resolution&#39;: &#39;50&#39;,
  &#39;sampling_frequency&#39;: &#39;2048.0&#39;,
  &#39;waveform_approximant&#39;: &#39;IMRPhenomD&#39;,
  &#39;minimum_frequency&#39;: &#39;20.0&#39;,
  &#39;snr_type&#39;: &#39;interpolation&#39;,
  &#39;psds&#39;: &#34;[PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/aLIGO_O4_high_asd.txt&#39;), PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/aLIGO_O4_high_asd.txt&#39;), PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/AdV_asd.txt&#39;)]&#34;,
  &#39;ifos&#39;: &#39;None&#39;,
  &#39;interpolator_dir&#39;: &#39;./interpolator_pickle&#39;,
  &#39;create_new_interpolator&#39;: &#39;False&#39;,
  &#39;gwsnr_verbose&#39;: &#39;True&#39;,
  &#39;multiprocessing_verbose&#39;: &#39;True&#39;,
  &#39;mtot_cut&#39;: &#39;True&#39;},
 &#39;detectable_gw_rate_per_year&#39;: 434.79616560249093,
 &#39;detectability_condition&#39;: &#39;step_function&#39;}
</pre></div></div>
</div>
<ul class="simple">
<li><p>plotting the redshift distribution of event parameters</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">plots</span> <span class="k">as</span> <span class="n">lerplt</span>


<span class="c1"># input param_dict can be either a dictionary or a json file name that contains the parameters</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s1">&#39;zs&#39;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="s1">&#39;ler_data/gw_param_detectable.json&#39;</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;zs (detectable)&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s1">&#39;zs&#39;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="s1">&#39;ler_data/gw_param.json&#39;</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;zs (all)&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
getting gw_params from json file ler_data/gw_param_detectable.json...
getting gw_params from json file ler_data/gw_param.json...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_rates_GWRATES_complete_exmaples_15_1.png" src="../../_images/examples_rates_GWRATES_complete_exmaples_15_1.png" />
</div>
</div>
</section>
<section id="Custom-functions">
<h2>Custom functions<a class="headerlink" href="#Custom-functions" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ler</span></code> allows internal model functions to be change with custom functions.</p></li>
<li><p>It also allows to change the default parameters of the existing model functions.</p></li>
</ul>
<p>First let’s look at what are the input parameters available for ler.GWRATES. The input paramters can divided into three categories</p>
<ol class="arabic simple">
<li><p>GWRATES set up params</p></li>
<li><p>CBCSourceParameterDistribution set up params (as kwargs)</p></li>
<li><p>GWSNR set up params (as kwargs)</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">GWRATES</span>
<span class="c1"># default initialization</span>
<span class="n">ler</span> <span class="o">=</span> <span class="n">GWRATES</span><span class="p">(</span><span class="n">npool</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
z_to_luminosity_distance interpolator will be loaded from ./interpolator_pickle/z_to_luminosity_distance/z_to_luminosity_distance_0.pickle
differential_comoving_volume interpolator will be loaded from ./interpolator_pickle/differential_comoving_volume/differential_comoving_volume_0.pickle
merger_rate_density_bbh_popI_II_oguri2018 interpolator will be loaded from ./interpolator_pickle/merger_rate_density_bbh_popI_II_oguri2018/merger_rate_density_bbh_popI_II_oguri2018_0.pickle
psds not given. Choosing bilby&#39;s default psds
npool:  4
snr type:  interpolation
waveform approximant:  IMRPhenomD
sampling frequency:  2048.0
minimum frequency (fmin):  20.0
mtot=mass1+mass2
min(mtot):  2.0
max(mtot) (with the given fmin=20.0): 184.98599853446768
detectors:  None
min(ratio):  0.1
max(ratio):  1.0
mtot resolution:  500
ratio resolution:  50
interpolator directory:  ./interpolator_pickle
Interpolator will be loaded for L1 detector from ./interpolator_pickle/L1/partialSNR_dict_0.pickle
Interpolator will be loaded for H1 detector from ./interpolator_pickle/H1/partialSNR_dict_0.pickle
Interpolator will be loaded for V1 detector from ./interpolator_pickle/V1/partialSNR_dict_0.pickle

 GWRATES set up params:
npool =  4
z_min =  0.0
z_max =  10.0
event_type =  BBH
size =  100000
batch_size =  50000
cosmology =  LambdaCDM(H0=70.0 km / (Mpc s), Om0=0.3, Ode0=0.7, Tcmb0=0.0 K, Neff=3.04, m_nu=None, Ob0=None)
snr_finder =  &lt;bound method GWSNR.snr of &lt;gwsnr.gwsnr.GWSNR object at 0x29cae4a60&gt;&gt;
json_file_names =  {&#39;gwrates_param&#39;: &#39;gwrates_params.json&#39;, &#39;gw_param&#39;: &#39;gw_param.json&#39;, &#39;gw_param_detectable&#39;: &#39;gw_param_detectable.json&#39;}
interpolator_directory =  ./interpolator_pickle

 GWRATES also takes CBCSourceParameterDistribution params as kwargs, as follows:
source_priors= {&#39;merger_rate_density&#39;: &#39;merger_rate_density_bbh_popI_II_oguri2018&#39;, &#39;source_frame_masses&#39;: &#39;binary_masses_BBH_popI_II_powerlaw_gaussian&#39;, &#39;zs&#39;: &#39;sample_source_redshift&#39;, &#39;geocent_time&#39;: &#39;sampler_uniform&#39;, &#39;ra&#39;: &#39;sampler_uniform&#39;, &#39;dec&#39;: &#39;sampler_cosine&#39;, &#39;phase&#39;: &#39;sampler_uniform&#39;, &#39;psi&#39;: &#39;sampler_uniform&#39;, &#39;theta_jn&#39;: &#39;sampler_sine&#39;}
source_priors_params= {&#39;merger_rate_density&#39;: {&#39;R0&#39;: 2.39e-08, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}, &#39;source_frame_masses&#39;: {&#39;mminbh&#39;: 4.98, &#39;mmaxbh&#39;: 112.5, &#39;alpha&#39;: 3.78, &#39;mu_g&#39;: 32.27, &#39;sigma_g&#39;: 3.88, &#39;lambda_peak&#39;: 0.03, &#39;delta_m&#39;: 4.8, &#39;beta&#39;: 0.81}, &#39;zs&#39;: None, &#39;geocent_time&#39;: {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}, &#39;ra&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;dec&#39;: None, &#39;phase&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;psi&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}, &#39;theta_jn&#39;: None}
spin_zero= True
spin_precession= False
create_new_interpolator= False

 GWRATES also takes GWSNR params as kwargs, as follows:
mtot_min =  2.0
mtot_max =  184.98599853446768
ratio_min =  0.1
ratio_max =  1.0
mtot_resolution =  500
ratio_resolution =  50
sampling_frequency =  2048.0
waveform_approximant =  IMRPhenomD
minimum_frequency =  20.0
snr_type =  interpolation
psds =  [PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/aLIGO_O4_high_asd.txt&#39;), PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/aLIGO_O4_high_asd.txt&#39;), PowerSpectralDensity(psd_file=&#39;None&#39;, asd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/AdV_asd.txt&#39;)]
ifos =  None
interpolator_dir =  ./interpolator_pickle
create_new_interpolator =  False
gwsnr_verbose =  True
multiprocessing_verbose =  True
mtot_cut =  True

 For reference, the chosen source parameters are listed below:
merger_rate_density =  merger_rate_density_bbh_popI_II_oguri2018
merger_rate_density_params =  {&#39;R0&#39;: 2.39e-08, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}
source_frame_masses =  binary_masses_BBH_popI_II_powerlaw_gaussian
source_frame_masses_params =  {&#39;mminbh&#39;: 4.98, &#39;mmaxbh&#39;: 112.5, &#39;alpha&#39;: 3.78, &#39;mu_g&#39;: 32.27, &#39;sigma_g&#39;: 3.88, &#39;lambda_peak&#39;: 0.03, &#39;delta_m&#39;: 4.8, &#39;beta&#39;: 0.81}
geocent_time =  sampler_uniform
geocent_time_params =  {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}
ra =  sampler_uniform
ra_params =  {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}
dec =  sampler_cosine
dec_params =  None
phase =  sampler_uniform
phase_params =  {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}
psi =  sampler_uniform
psi_params =  {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}
theta_jn =  sampler_sine
theta_jn_params =  None
</pre></div></div>
</div>
<p>As an example, I will change,</p>
<ul class="simple">
<li><p>merger_rate_density_params’s default value of <strong>local merger rate density</strong> (<span class="math notranslate nohighlight">\(R_0\)</span>) to 2.5e-9 <span class="math notranslate nohighlight">\(Mpc^{-3} yr^{-1}\)</span>. But, I am still using the default merger_rate_density function, which is ‘merger_rate_density_bbh_popI_II_oguri2018’.</p></li>
<li><p><strong>source_frame_masses</strong> to a custom function. This is similar to the internal default function, i.e. PowerLaw+Peak model. I am using <code class="docutils literal notranslate"><span class="pre">gwcosmo</span></code>’s powerlaw_gaussian prior for this example.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gwsnr</span></code> parameters: By default, it uses ‘IMRPhenomD’ <strong>waveform model</strong> with no spin. It uses interpolation method to find the ‘snr’ and it is super fast. But for the example below, I am using ‘IMRPhenomXPHM` with precessing spins. This is without interpolation but through inner product method. It will be slower.</p></li>
</ul>
<p><strong>Note:</strong> All custom functions should have ‘size’ as the only input.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gwcosmo</span> <span class="kn">import</span> <span class="n">priors</span> <span class="k">as</span> <span class="n">p</span>

<span class="c1"># define your custom function of mass_1_source and mass_2_source calculation</span>
<span class="c1"># it should have &#39;size&#39; as the only argument</span>
<span class="k">def</span> <span class="nf">powerlaw_peak</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to sample mass1 and mass2 from a powerlaw with a gaussian peak</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size : `int`</span>
<span class="sd">        Number of samples to draw</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mass_1_source : `numpy.ndarray`</span>
<span class="sd">        Array of mass1 samples</span>
<span class="sd">    mass_2_source : `numpy.ndarray`</span>
<span class="sd">        Array of mass2 samples</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1"># below is the gwcosmo default values</span>
    <span class="n">mminbh</span><span class="o">=</span><span class="mf">4.98</span>  <span class="c1"># Minimum mass of the black hole (Msun)</span>
    <span class="n">mmaxbh</span><span class="o">=</span><span class="mf">86.22</span>  <span class="c1"># Maximum mass of the black hole (Msun)</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">2.63</span>  <span class="c1"># Spectral index for the powerlaw of the primary mass distribution</span>
    <span class="n">mu_g</span><span class="o">=</span><span class="mf">33.07</span>  <span class="c1"># Mean of the Gaussian component in the primary mass distribution</span>
    <span class="n">sigma_g</span><span class="o">=</span><span class="mf">5.69</span>  <span class="c1"># Width of the Gaussian component in the primary mass distribution</span>
    <span class="n">lambda_peak</span><span class="o">=</span><span class="mf">0.10</span>  <span class="c1"># Fraction of the model in the Gaussian component</span>
    <span class="n">delta_m</span><span class="o">=</span><span class="mf">4.82</span>  <span class="c1"># Range of mass tapering on the lower end of the mass distribution</span>
    <span class="n">beta</span><span class="o">=</span><span class="mf">1.26</span>  <span class="c1"># Spectral index for the powerlaw of the mass ratio distribution</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">BBH_powerlaw_gaussian</span><span class="p">(</span>
        <span class="n">mminbh</span><span class="o">=</span><span class="n">mminbh</span><span class="p">,</span>
        <span class="n">mmaxbh</span><span class="o">=</span><span class="n">mmaxbh</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">mu_g</span><span class="o">=</span><span class="n">mu_g</span><span class="p">,</span>
        <span class="n">sigma_g</span><span class="o">=</span><span class="n">sigma_g</span><span class="p">,</span>
        <span class="n">lambda_peak</span><span class="o">=</span><span class="n">lambda_peak</span><span class="p">,</span>
        <span class="n">delta_m</span><span class="o">=</span><span class="n">delta_m</span><span class="p">,</span>
        <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># sample mass1 and mass2</span>
    <span class="n">mass_1_source</span><span class="p">,</span> <span class="n">mass_2_source</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">Nsample</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">mass_1_source</span><span class="p">,</span> <span class="n">mass_2_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>Initialize the class with the custom function</p></li>
<li><p>changing gwrates input params</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span> <span class="o">=</span> <span class="n">GWRATES</span><span class="p">(</span><span class="n">npool</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">source_priors</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">merger_rate_density</span><span class="o">=</span><span class="s1">&#39;merger_rate_density_bbh_popI_II_oguri2018&#39;</span><span class="p">,</span>
        <span class="n">source_frame_masses</span><span class="o">=</span><span class="n">powerlaw_peak</span><span class="p">,</span>
    <span class="p">),</span>
   <span class="n">source_priors_params</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">merger_rate_density</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">R0</span><span class="o">=</span><span class="mf">2.9e-08</span><span class="p">,</span>
            <span class="n">b2</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span>
            <span class="n">b3</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
            <span class="n">b4</span><span class="o">=</span><span class="mi">30</span>
        <span class="p">),</span>
        <span class="n">source_frame_masses</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">mminbh</span><span class="o">=</span><span class="mf">4.98</span><span class="p">,</span>
            <span class="n">mmaxbh</span><span class="o">=</span><span class="mf">86.22</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">2.63</span><span class="p">,</span>
            <span class="n">mu_g</span><span class="o">=</span><span class="mf">33.07</span><span class="p">,</span>
            <span class="n">sigma_g</span><span class="o">=</span><span class="mf">5.69</span><span class="p">,</span>
            <span class="n">lambda_peak</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span>
            <span class="n">delta_m</span><span class="o">=</span><span class="mf">4.82</span><span class="p">,</span>
            <span class="n">beta</span><span class="o">=</span><span class="mf">1.26</span>
        <span class="p">),</span>
   <span class="p">),</span>
   <span class="n">waveform_approximant</span> <span class="o">=</span> <span class="s1">&#39;IMRPhenomXPHM&#39;</span><span class="p">,</span>
   <span class="n">snr_type</span><span class="o">=</span><span class="s1">&#39;inner_product&#39;</span><span class="p">,</span>
   <span class="n">spin_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
   <span class="n">spin_precession</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>simulation of the GW CBC (compact-binary-coalescence) population</p></li>
<li><p>you can set the batch size at the gwarates initialization too.</p></li>
<li><p>or you can set it using the <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> instance variable</p></li>
<li><p>if the sample size is large, it is recommended to set the batch size to a large number, but it will consume more RAM memory or simply your machine’s individual core won’t be able to handle it.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">50000</span>
<span class="n">ler</span><span class="o">.</span><span class="n">gw_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_jsonfile</span> <span class="o">=</span> <span class="s1">&#39;new_gw_params.json&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulated GW params will be stored in ./ler_data/new_gw_params.json
chosen batch size = 50000 with total size = 100000
There will be 2 batche(s)
Batch no. 1
sampling gw source params...
calculating snrs...
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|████████████████████████████████████████████████████████| 40696/40696 [00:56&lt;00:00, 715.21it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch no. 2
sampling gw source params...
calculating snrs...
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|████████████████████████████████████████████████████████| 40758/40758 [00:55&lt;00:00, 736.63it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
saving all gw_params in ./ler_data/new_gw_params.json...
</pre></div></div>
</div>
<ul class="simple">
<li><p>you can also also called the generated parameters using an instance attribute. This instance attribute gets the dict from the json file generated above.</p></li>
<li><p>This is for spin-precessing systems, and it will contain extra (spin-related) parameters.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_param</span>
<span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;a_1&#39;, &#39;a_2&#39;, &#39;tilt_1&#39;, &#39;tilt_2&#39;, &#39;phi_12&#39;, &#39;phi_jl&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;, &#39;optimal_snr_net&#39;])
</pre></div></div>
</div>
<ul class="simple">
<li><p>generate detectable events</p></li>
<li><p>and get the rate of detectable events</p></li>
<li><p>You have two choice to input the generated parameters, either as json file name or as a dict</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ler.gw_rate(); # this is short hand for the following</span>
<span class="n">rate</span><span class="p">,</span> <span class="n">param_detectable</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_rate</span><span class="p">(</span>
    <span class="n">gw_param</span><span class="o">=</span><span class="s1">&#39;new_gw_params.json&#39;</span><span class="p">,</span>
    <span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;new_gw_params_detectable.json&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
getting gw_params from json file ./ler_data/new_gw_params.json...
total gw rate (yr^-1) (with step function): 914.1071767309512
number of simulated gw detectable events: 883
number of all simulated gw events: 100000
storing detectable gw params in ./ler_data/new_gw_params_detectable.json
</pre></div></div>
</div>
<ul class="simple">
<li><p>to check all the stored json file names</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span><span class="o">.</span><span class="n">json_file_names</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;gwrates_param&#39;: &#39;gwrates_params.json&#39;,
 &#39;gw_param&#39;: &#39;new_gw_params.json&#39;,
 &#39;gw_param_detectable&#39;: &#39;new_gw_params_detectable.json&#39;}
</pre></div></div>
</div>
<ul class="simple">
<li><p>again you can call the generated detectable events’ parameters using an instance attribute</p></li>
<li><p>Note: The data is not stored in this instance attribute, it is stored in the json file. This scheme is used to save RAM memory.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_detectable</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_param_detectable</span>
<span class="nb">print</span><span class="p">(</span><span class="n">param_detectable</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;a_1&#39;, &#39;a_2&#39;, &#39;tilt_1&#39;, &#39;tilt_2&#39;, &#39;phi_12&#39;, &#39;phi_jl&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;, &#39;optimal_snr_net&#39;])
</pre></div></div>
</div>
<section id="How-to-look-for-available-model-functions?">
<h3>How to look for available model functions?<a class="headerlink" href="#How-to-look-for-available-model-functions?" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>All available names are stored as a dict in <code class="docutils literal notranslate"><span class="pre">ler</span></code> instance</p></li>
<li><p>the keys of this dict shows the parameter type</p></li>
<li><p>the values are also dict, where the keys are the model function names and the values are their input parameters</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s look at one of the dict key</span>
<span class="n">ler</span><span class="o">.</span><span class="n">available_gw_prior_list_and_its_params</span><span class="p">[</span><span class="s1">&#39;source_frame_masses&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;binary_masses_BBH_popI_II_powerlaw_gaussian&#39;: {&#39;mminbh&#39;: 4.98,
  &#39;mmaxbh&#39;: 112.5,
  &#39;alpha&#39;: 3.78,
  &#39;mu_g&#39;: 32.27,
  &#39;sigma_g&#39;: 3.88,
  &#39;lambda_peak&#39;: 0.03,
  &#39;delta_m&#39;: 4.8,
  &#39;beta&#39;: 0.81},
 &#39;binary_masses_BBH_popIII_lognormal&#39;: {&#39;Mc&#39;: 30.0, &#39;sigma&#39;: 0.3, &#39;beta&#39;: 1.1},
 &#39;binary_masses_BBH_primordial_lognormal&#39;: {&#39;Mc&#39;: 30.0,
  &#39;sigma&#39;: 0.3,
  &#39;beta&#39;: 1.1},
 &#39;binary_masses_BNS_gwcosmo&#39;: {&#39;mminns&#39;: 1.0, &#39;mmaxns&#39;: 3.0, &#39;alphans&#39;: 0.0},
 &#39;binary_masses_BNS_bimodal&#39;: {&#39;w&#39;: 0.643,
  &#39;muL&#39;: 1.352,
  &#39;sigmaL&#39;: 0.08,
  &#39;muR&#39;: 1.88,
  &#39;sigmaR&#39;: 0.3,
  &#39;mmin&#39;: 1.0,
  &#39;mmax&#39;: 2.3}}
</pre></div></div>
</div>
<ul class="simple">
<li><p>for looking at the choosen models and its input parameters</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">gw_param_samplers</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ler</span><span class="o">.</span><span class="n">gw_param_samplers_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;merger_rate_density&#39;: &#39;merger_rate_density_bbh_popI_II_oguri2018&#39;, &#39;source_frame_masses&#39;: &lt;function powerlaw_peak at 0x2ea7eadd0&gt;, &#39;zs&#39;: &#39;sample_source_redshift&#39;, &#39;geocent_time&#39;: &#39;sampler_uniform&#39;, &#39;ra&#39;: &#39;sampler_uniform&#39;, &#39;dec&#39;: &#39;sampler_cosine&#39;, &#39;phase&#39;: &#39;sampler_uniform&#39;, &#39;psi&#39;: &#39;sampler_uniform&#39;, &#39;theta_jn&#39;: &#39;sampler_sine&#39;, &#39;a_1&#39;: &#39;sampler_uniform&#39;, &#39;a_2&#39;: &#39;sampler_uniform&#39;, &#39;tilt_1&#39;: &#39;sampler_sine&#39;, &#39;tilt_2&#39;: &#39;sampler_sine&#39;, &#39;phi_12&#39;: &#39;sampler_uniform&#39;, &#39;phi_jl&#39;: &#39;sampler_uniform&#39;}
{&#39;merger_rate_density&#39;: {&#39;R0&#39;: 2.9e-08, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}, &#39;source_frame_masses&#39;: {&#39;mminbh&#39;: 4.98, &#39;mmaxbh&#39;: 86.22, &#39;alpha&#39;: 2.63, &#39;mu_g&#39;: 33.07, &#39;sigma_g&#39;: 5.69, &#39;lambda_peak&#39;: 0.1, &#39;delta_m&#39;: 4.82, &#39;beta&#39;: 1.26}, &#39;zs&#39;: None, &#39;geocent_time&#39;: {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}, &#39;ra&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;dec&#39;: None, &#39;phase&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;psi&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}, &#39;theta_jn&#39;: None, &#39;a_1&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 0.8}, &#39;a_2&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 0.8}, &#39;tilt_1&#39;: None, &#39;tilt_2&#39;: None, &#39;phi_12&#39;: {&#39;min_&#39;: 0, &#39;max_&#39;: 6.283185307179586}, &#39;phi_jl&#39;: {&#39;min_&#39;: 0, &#39;max_&#39;: 6.283185307179586}}
</pre></div></div>
</div>
</section>
</section>
<section id="Using-internal-model-functions">
<h2>Using internal model functions<a class="headerlink" href="#Using-internal-model-functions" title="Link to this heading"></a></h2>
<section id="Mass-distribution-of-BBH-(mass-1,-larger-mass-only)">
<h3>Mass distribution of BBH (mass-1, larger mass only)<a class="headerlink" href="#Mass-distribution-of-BBH-(mass-1,-larger-mass-only)" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>compare the default mass distribution with the custom mass distribution</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calling the default mass distribution model</span>
<span class="n">mass_1_source</span><span class="p">,</span> <span class="n">mass_2_source</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">binary_masses_BBH_popI_II_powerlaw_gaussian</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">default_model_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mass_1_source</span><span class="o">=</span><span class="n">mass_1_source</span><span class="p">)</span>

<span class="c1"># calling the custom mass distribution model</span>
<span class="n">mass_1_source</span><span class="p">,</span> <span class="n">mass_2_source</span> <span class="o">=</span> <span class="n">powerlaw_peak</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">custom_model_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mass_1_source</span><span class="o">=</span><span class="n">mass_1_source</span><span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>let’s do a comparision plot between you custom model and the default model</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">plots</span> <span class="k">as</span> <span class="n">lerplt</span>

<span class="c1"># let&#39;s do a comparision plot between you custom model and the default model</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;mass_1_source&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">custom_model_dict</span><span class="p">,</span> <span class="c1"># or the json file name</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;custom model&#39;</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;mass_1_source&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">default_model_dict</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;default model&#39;</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;source $m_1$ ($M_{\odot}$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p(source mass_1)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_rates_GWRATES_complete_exmaples_40_0.png" src="../../_images/examples_rates_GWRATES_complete_exmaples_40_0.png" />
</div>
</div>
</section>
</section>
<section id="Selecting-particular-number-of-detectable-events">
<h2>Selecting particular number of detectable events<a class="headerlink" href="#Selecting-particular-number-of-detectable-events" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>this is particularly useful when you want only the detectable events to be saved in the json file</p></li>
<li><p>detectable event rates will be calculated at each batches. Subsequent batch will consider the previous batch’s detectable events. So, the rates will become more accurate as the iterations increases and will converge to a stable value at higher samples.</p></li>
<li><p>you can resume the rate calculation from the last saved batch.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">GWRATES</span>
<span class="n">ler</span> <span class="o">=</span> <span class="n">GWRATES</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>sampling till desired number of detectable events are found</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_size_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">selecting_n_gw_detectable_events</span><span class="p">(</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
    <span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
    <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;gw_params_n_detectable.json&#39;</span><span class="p">,</span>
    <span class="n">meta_data_file</span><span class="o">=</span><span class="s2">&quot;meta_gw.json&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
collected number of detectable events =  0
collected number of detectable events =  209
total number of events =  50000
total gw rate (yr^-1): 432.7257076710505
collected number of detectable events =  408
total number of events =  100000
total gw rate (yr^-1): 422.3734180138484
collected number of detectable events =  613
total number of events =  150000
total gw rate (yr^-1): 423.0635706576618
collected number of detectable events =  867
total number of events =  200000
total gw rate (yr^-1): 448.7717566397139
collected number of detectable events =  1058
total number of events =  250000
total gw rate (yr^-1): 438.1088982927956
collected number of detectable events =  1283
total number of events =  300000
total gw rate (yr^-1): 442.732921006346
collected number of detectable events =  1484
total number of events =  350000
total gw rate (yr^-1): 438.93708146537176
collected number of detectable events =  1699
total number of events =  400000
total gw rate (yr^-1): 439.71350318966194
collected number of detectable events =  1896
total number of events =  450000
total gw rate (yr^-1): 436.1764708901179
collected number of detectable events =  2103
total number of events =  500000
total gw rate (yr^-1): 435.41730298192306
collected number of detectable events =  2313
total number of events =  550000
total gw rate (yr^-1): 435.3608359474292
collected number of detectable events =  2526
total number of events =  600000
total gw rate (yr^-1): 435.8313945682111
collected number of detectable events =  2732
total number of events =  650000
total gw rate (yr^-1): 435.1146975919433
collected number of detectable events =  2959
total number of events =  700000
total gw rate (yr^-1): 437.60607279516006
collected number of detectable events =  3150
total number of events =  750000
total gw rate (yr^-1): 434.79616560249093
collected number of detectable events =  3363
total number of events =  800000
total gw rate (yr^-1): 435.18437646463605
collected number of detectable events =  3549
total number of events =  850000
total gw rate (yr^-1): 432.2385410989469
collected number of detectable events =  3752
total number of events =  900000
total gw rate (yr^-1): 431.57545326469466
collected number of detectable events =  3954
total number of events =  950000
total gw rate (yr^-1): 430.8731926797617
collected number of detectable events =  4158
total number of events =  1000000
total gw rate (yr^-1): 430.44820394646604
collected number of detectable events =  4392
total number of events =  1050000
total gw rate (yr^-1): 433.021487375542
collected number of detectable events =  4595
total number of events =  1100000
total gw rate (yr^-1): 432.44337249858137
collected number of detectable events =  4786
total number of events =  1150000
total gw rate (yr^-1): 430.8352895597353
collected number of detectable events =  5022
total number of events =  1200000
total gw rate (yr^-1): 433.2433221539106
storing detectable gw params in ./ler_data/gw_params_n_detectable.json

 trmming final result to size=5000
</pre></div></div>
</div>
<p><strong>Important Note</strong>: At each iteration, rate is calculated using the cummulatively increasing number of events. It become stable at around 2 million events. This is the number of events that is required to get a stable rate.</p>
<ul class="simple">
<li><p>Now get the sampled (detectable) events.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">n_size_param</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;size of each parameters=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">n_size_param</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;, &#39;optimal_snr_net&#39;])
size of each parameters=5000
</pre></div></div>
</div>
<ul class="simple">
<li><p>let’s see the meta file</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">load_json</span>

<span class="n">meta</span> <span class="o">=</span> <span class="n">load_json</span><span class="p">(</span><span class="s1">&#39;ler_data/meta_gw.json&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;events_total&#39;: [50000, 100000, 150000, 200000, 250000, 300000, 350000, 400000, 450000, 500000, 550000, 600000, 650000, 700000, 750000, 800000, 850000, 900000, 950000, 1000000, 1050000, 1100000, 1150000, 1200000], &#39;detectable_events&#39;: [209.0, 408.0, 613.0, 867.0, 1058.0, 1283.0, 1484.0, 1699.0, 1896.0, 2103.0, 2313.0, 2526.0, 2732.0, 2959.0, 3150.0, 3363.0, 3549.0, 3752.0, 3954.0, 4158.0, 4392.0, 4595.0, 4786.0, 5022.0], &#39;total_rate&#39;: [432.7257076710505, 422.3734180138484, 423.0635706576618, 448.7717566397139, 438.1088982927956, 442.732921006346, 438.93708146537176, 439.71350318966194, 436.1764708901179, 435.41730298192306, 435.3608359474292, 435.8313945682111, 435.1146975919433, 437.60607279516006, 434.79616560249093, 435.18437646463605, 432.2385410989469, 431.57545326469466, 430.8731926797617, 430.44820394646604, 433.021487375542, 432.44337249858137, 430.8352895597353, 433.2433221539106]}
</pre></div></div>
</div>
</section>
<section id="Utilizing-the-ANN-feature-of-the-gwsnr">
<h2>Utilizing the ANN feature of the <code class="docutils literal notranslate"><span class="pre">gwsnr</span></code><a class="headerlink" href="#Utilizing-the-ANN-feature-of-the-gwsnr" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>This particularly useful when you are considering spin-precessing systems.</p></li>
<li><p>inner product method is slow, ann method is faster alternative.</p></li>
<li><p>But it is not very accurate in calculating the absolute value snr, but it is fine for checking the detectability of the events (accuracy&gt;98%).</p></li>
<li><p>The example below is important when you want the accurate SNR value only for the detectable events.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">GWRATES</span>
<span class="c1"># class initialization</span>
<span class="n">ler</span> <span class="o">=</span> <span class="n">GWRATES</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">snr_type</span><span class="o">=</span><span class="s1">&#39;ann&#39;</span><span class="p">,</span> <span class="n">waveform_approximant</span><span class="o">=</span><span class="s1">&#39;IMRPhenomXPHM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># event sampling</span>
<span class="c1"># make size=1000000 for better statistics</span>
<span class="n">ler</span><span class="o">.</span><span class="n">gw_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_jsonfile</span> <span class="o">=</span> <span class="s1">&#39;gw_params.json&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulated GW params will be stored in ./ler_data/gw_params.json
chosen batch size = 100000 with total size = 200000
There will be 2 batche(s)
Batch no. 1
sampling gw source params...
calculating snrs...
Batch no. 2
sampling gw source params...
calculating snrs...
saving all gw_params in ./ler_data/gw_params.json...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rate calculation</span>
<span class="c1"># snr recalculation</span>
<span class="n">ler</span><span class="o">.</span><span class="n">gw_rate</span><span class="p">(</span><span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
            <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;gw_params_detectable.json&#39;</span><span class="p">,</span>
            <span class="n">snr_recalculation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># if True, it will recalculate the SNR with inner product method</span>
            <span class="n">threshold_snr_recalculation</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span>  <span class="c1"># re-calculate SNR for events with SNR greater than this value</span>
            <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
getting gw_params from json file ./ler_data/gw_params.json...
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████████████████████████████████████████████████████| 2254/2254 [00:06&lt;00:00, 334.15it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
total gw rate (yr^-1) (with step function): 466.3706490569575
number of simulated gw detectable events: 901
number of all simulated gw events: 200000
storing detectable gw params in ./ler_data/gw_params_detectable.json
</pre></div></div>
</div>
<ul class="simple">
<li><p>Now let’s repeat the above example with the <code class="docutils literal notranslate"><span class="pre">inner</span> <span class="pre">product</span></code> method to check the accuracy of the <code class="docutils literal notranslate"><span class="pre">ann</span></code> method.</p></li>
<li><p>This will take a while to run.</p></li>
<li><p>as of 24.02.2024 <code class="docutils literal notranslate"><span class="pre">ann</span></code> is available only for default detector network and psds.</p></li>
<li><p>contact the author for custom detector network and psds, or you can do it yourself by following the <code class="docutils literal notranslate"><span class="pre">gwsnr</span></code>’s ann model development example.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">GWRATES</span>
<span class="c1"># class initialization</span>
<span class="n">ler</span> <span class="o">=</span> <span class="n">GWRATES</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">snr_type</span><span class="o">=</span><span class="s1">&#39;inner_product&#39;</span><span class="p">,</span> <span class="n">waveform_approximant</span><span class="o">=</span><span class="s1">&#39;IMRPhenomXPHM&#39;</span><span class="p">)</span>
<span class="c1"># event sampling</span>
<span class="c1">#</span>
<span class="n">ler</span><span class="o">.</span><span class="n">gw_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_jsonfile</span> <span class="o">=</span> <span class="s1">&#39;gw_params.json&#39;</span><span class="p">);</span>
<span class="c1"># rate calculation</span>
<span class="n">ler</span><span class="o">.</span><span class="n">gw_rate</span><span class="p">(</span><span class="n">snr_threshold</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
            <span class="n">output_jsonfile</span><span class="o">=</span><span class="s1">&#39;gw_params_detectable.json&#39;</span><span class="p">,</span>
            <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulated GW params will be stored in ./ler_data/gw_params.json
chosen batch size = 100000 with total size = 200000
There will be 2 batche(s)
Batch no. 1
sampling gw source params...
calculating snrs...
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|████████████████████████████████████████████████████████| 92509/92509 [08:20&lt;00:00, 184.77it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch no. 2
sampling gw source params...
calculating snrs...
solving SNR with inner product
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|████████████████████████████████████████████████████████| 92506/92506 [01:56&lt;00:00, 795.14it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
saving all gw_params in ./ler_data/gw_params.json...
getting gw_params from json file ./ler_data/gw_params.json...
total gw rate (yr^-1) (with step function): 443.07799732825265
number of simulated gw detectable events: 856
number of all simulated gw events: 200000
storing detectable gw params in ./ler_data/gw_params_detectable.json
</pre></div></div>
</div>
<ul class="simple">
<li><p>close enough</p></li>
<li><p>For more matching results, you can increase the number of events to 1,000,000 or more.</p></li>
</ul>
</section>
<section id="BNS-(Binary-Neutron-Star)-example">
<h2>BNS (Binary Neutron Star) example<a class="headerlink" href="#BNS-(Binary-Neutron-Star)-example" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>All you need is to change is <code class="docutils literal notranslate"><span class="pre">event_type</span></code> in class initialization to ‘BNS’.</p></li>
<li><p>But in this example, I will also change the detector network to [‘CE’, ‘ET’]. These are future 3rd generation detectors. Since, they are more sensitive, I will change the redshift range to 0-20 (z_max=20).</p></li>
<li><p>The default mass distribution model has a mass-cutoff of 2.3 Msun. So, the maximum possible redshifted total mass is (2.3+2.3)*(1+z_max)=96.6. This allows, gwsnr to have a good interpolation for the snr values.</p></li>
<li><p>Difference in the models for BNS and BBH are:</p>
<ul>
<li><p>mass distribution model: bimodal distribution. Refer to <a class="reference external" href="https://arxiv.org/pdf/2005.00032.pdf">Will M. Farr et al. 2020</a> Eqn. 6</p></li>
<li><p>merger rate density model parameter: local merger rate density value from <a class="reference external" href="https://journals.aps.org/prx/pdf/10.1103/PhysRevX.13.011048">GWTC-3 catalog, Section IV A</a>.</p></li>
</ul>
</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">GWRATES</span>

<span class="n">ler</span> <span class="o">=</span> <span class="n">GWRATES</span><span class="p">(</span><span class="n">event_type</span><span class="o">=</span><span class="s1">&#39;BNS&#39;</span><span class="p">,</span> <span class="n">ifos</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CE&#39;</span><span class="p">,</span> <span class="s1">&#39;ET&#39;</span><span class="p">],</span> <span class="n">z_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_max</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">mtot_max</span><span class="o">=</span><span class="mf">96.6</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
z_to_luminosity_distance interpolator will be loaded from ./interpolator_pickle/z_to_luminosity_distance/z_to_luminosity_distance_1.pickle
differential_comoving_volume interpolator will be loaded from ./interpolator_pickle/differential_comoving_volume/differential_comoving_volume_2.pickle
merger_rate_density_bbh_popI_II_oguri2018 interpolator will be loaded from ./interpolator_pickle/merger_rate_density_bbh_popI_II_oguri2018/merger_rate_density_bbh_popI_II_oguri2018_2.pickle
binary_masses_BNS_bimodal interpolator will be loaded from ./interpolator_pickle/binary_masses_BNS_bimodal/binary_masses_BNS_bimodal_0.pickle
npool:  4
snr type:  interpolation
waveform approximant:  IMRPhenomD
sampling frequency:  2048.0
minimum frequency (fmin):  20.0
mtot=mass1+mass2
min(mtot):  2.0
max(mtot) (with the given fmin=20.0): 96.6
detectors:  None
min(ratio):  0.1
max(ratio):  1.0
mtot resolution:  500
ratio resolution:  50
interpolator directory:  ./interpolator_pickle
Interpolator will be loaded for CE detector from ./interpolator_pickle/CE/partialSNR_dict_0.pickle
Interpolator will be loaded for ET1 detector from ./interpolator_pickle/ET1/partialSNR_dict_0.pickle
Interpolator will be loaded for ET2 detector from ./interpolator_pickle/ET2/partialSNR_dict_0.pickle
Interpolator will be loaded for ET3 detector from ./interpolator_pickle/ET3/partialSNR_dict_0.pickle

 GWRATES set up params:
npool =  4
z_min =  0
z_max =  20
event_type =  BNS
size =  100000
batch_size =  50000
cosmology =  LambdaCDM(H0=70.0 km / (Mpc s), Om0=0.3, Ode0=0.7, Tcmb0=0.0 K, Neff=3.04, m_nu=None, Ob0=None)
snr_finder =  &lt;bound method GWSNR.snr of &lt;gwsnr.gwsnr.GWSNR object at 0x2901a98a0&gt;&gt;
json_file_names =  {&#39;gwrates_param&#39;: &#39;gwrates_params.json&#39;, &#39;gw_param&#39;: &#39;gw_param.json&#39;, &#39;gw_param_detectable&#39;: &#39;gw_param_detectable.json&#39;}
interpolator_directory =  ./interpolator_pickle

 GWRATES also takes CBCSourceParameterDistribution params as kwargs, as follows:
source_priors= {&#39;merger_rate_density&#39;: &#39;merger_rate_density_bbh_popI_II_oguri2018&#39;, &#39;source_frame_masses&#39;: &#39;binary_masses_BNS_bimodal&#39;, &#39;zs&#39;: &#39;sample_source_redshift&#39;, &#39;geocent_time&#39;: &#39;sampler_uniform&#39;, &#39;ra&#39;: &#39;sampler_uniform&#39;, &#39;dec&#39;: &#39;sampler_cosine&#39;, &#39;phase&#39;: &#39;sampler_uniform&#39;, &#39;psi&#39;: &#39;sampler_uniform&#39;, &#39;theta_jn&#39;: &#39;sampler_sine&#39;}
source_priors_params= {&#39;merger_rate_density&#39;: {&#39;R0&#39;: 1.0550000000000001e-07, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}, &#39;source_frame_masses&#39;: {&#39;w&#39;: 0.643, &#39;muL&#39;: 1.352, &#39;sigmaL&#39;: 0.08, &#39;muR&#39;: 1.88, &#39;sigmaR&#39;: 0.3, &#39;mmin&#39;: 1.0, &#39;mmax&#39;: 2.3}, &#39;zs&#39;: None, &#39;geocent_time&#39;: {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}, &#39;ra&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;dec&#39;: None, &#39;phase&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}, &#39;psi&#39;: {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}, &#39;theta_jn&#39;: None}
spin_zero= True
spin_precession= False
create_new_interpolator= False

 GWRATES also takes GWSNR params as kwargs, as follows:
mtot_min =  2.0
mtot_max =  96.6
ratio_min =  0.1
ratio_max =  1.0
mtot_resolution =  500
ratio_resolution =  50
sampling_frequency =  2048.0
waveform_approximant =  IMRPhenomD
minimum_frequency =  20.0
snr_type =  interpolation
psds =  [PowerSpectralDensity(psd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/CE_psd.txt&#39;, asd_file=&#39;None&#39;), PowerSpectralDensity(psd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/ET_D_psd.txt&#39;, asd_file=&#39;None&#39;), PowerSpectralDensity(psd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/ET_D_psd.txt&#39;, asd_file=&#39;None&#39;), PowerSpectralDensity(psd_file=&#39;/Users/phurailatpamhemantakumar/anaconda3/envs/ler/lib/python3.10/site-packages/bilby/gw/detector/noise_curves/ET_D_psd.txt&#39;, asd_file=&#39;None&#39;)]
ifos =  [&#39;CE&#39;, &#39;ET&#39;]
interpolator_dir =  ./interpolator_pickle
create_new_interpolator =  False
gwsnr_verbose =  True
multiprocessing_verbose =  True
mtot_cut =  True

 For reference, the chosen source parameters are listed below:
merger_rate_density =  merger_rate_density_bbh_popI_II_oguri2018
merger_rate_density_params =  {&#39;R0&#39;: 1.0550000000000001e-07, &#39;b2&#39;: 1.6, &#39;b3&#39;: 2.0, &#39;b4&#39;: 30}
source_frame_masses =  binary_masses_BNS_bimodal
source_frame_masses_params =  {&#39;w&#39;: 0.643, &#39;muL&#39;: 1.352, &#39;sigmaL&#39;: 0.08, &#39;muR&#39;: 1.88, &#39;sigmaR&#39;: 0.3, &#39;mmin&#39;: 1.0, &#39;mmax&#39;: 2.3}
geocent_time =  sampler_uniform
geocent_time_params =  {&#39;min_&#39;: 1238166018, &#39;max_&#39;: 1269702018}
ra =  sampler_uniform
ra_params =  {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}
dec =  sampler_cosine
dec_params =  None
phase =  sampler_uniform
phase_params =  {&#39;min_&#39;: 0.0, &#39;max_&#39;: 6.283185307179586}
psi =  sampler_uniform
psi_params =  {&#39;min_&#39;: 0.0, &#39;max_&#39;: 3.141592653589793}
theta_jn =  sampler_sine
theta_jn_params =  None
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_cbc_statistics</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_batch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulated GW params will be stored in ./ler_data/gw_param.json
chosen batch size = 100000 with total size = 200000
There will be 2 batche(s)
Batch no. 1
sampling gw source params...
calculating snrs...
Batch no. 2
sampling gw source params...
calculating snrs...
saving all gw_params in ./ler_data/gw_param.json...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span><span class="o">.</span><span class="n">gw_rate</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
getting gw_params from json file ./ler_data/gw_param.json...
total gw rate (yr^-1) (with step function): 37728.84893984636
number of simulated gw detectable events: 72523
number of all simulated gw events: 200000
storing detectable gw params in ./ler_data/gw_param.json
</pre></div></div>
</div>
<ul class="simple">
<li><p>Let’s plot the redshift and mass distribution</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># ler.utils has a function for plotting histograms and KDEs</span>
<span class="kn">from</span> <span class="nn">ler.utils</span> <span class="kn">import</span> <span class="n">plots</span> <span class="k">as</span> <span class="n">lerplt</span>

<span class="n">params</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_param</span>
<span class="n">params_detectable</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_param_detectable</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sample source redshifts (source frame)</span>
<span class="n">zs</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">]</span>
<span class="n">zs_detectable</span> <span class="o">=</span> <span class="n">params_detectable</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;zs&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="c1"># or the json file name</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
    <span class="n">histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;zs&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">params_detectable</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="s1">&#39;detectable&#39;</span><span class="p">,</span>
    <span class="n">histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;source redshift ($z_s$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$p(z_s)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_rates_GWRATES_complete_exmaples_63_0.png" src="../../_images/examples_rates_GWRATES_complete_exmaples_63_0.png" />
</div>
</div>
<ul class="simple">
<li><p>From this result, it should be known that you could set z_max lower (as well as mtot_max).</p></li>
<li><p>now, let’s source mass_distribution (source frame).</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;mass_1_source&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="c1"># or the json file name</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$m_1^</span><span class="si">{src}</span><span class="s2">$&quot;</span><span class="p">,</span>
    <span class="n">histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">lerplt</span><span class="o">.</span><span class="n">param_plot</span><span class="p">(</span>
    <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;mass_2_source&quot;</span><span class="p">,</span>
    <span class="n">param_dict</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
    <span class="n">plot_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$m_2^</span><span class="si">{src}</span><span class="s2">$&quot;</span><span class="p">,</span>
    <span class="n">histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;source redshift ($m^</span><span class="si">{src}</span><span class="s1"> M_{\odot}$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;p($m_1^</span><span class="si">{src}</span><span class="s1">$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_rates_GWRATES_complete_exmaples_65_0.png" src="../../_images/examples_rates_GWRATES_complete_exmaples_65_0.png" />
</div>
</div>
</section>
<section id="Using-custom-detection-criteria">
<h2>Using custom detection criteria<a class="headerlink" href="#Using-custom-detection-criteria" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>let’s replace the default calculator in <code class="docutils literal notranslate"><span class="pre">GWRATES</span></code> with a ‘pdet’ calculator.</p></li>
<li><p>I choose a ‘pdet’ calculator from gwsnr that’s checks whether the event has snr&gt;8 or not.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ler.rates</span> <span class="kn">import</span> <span class="n">GWRATES</span>
<span class="kn">from</span> <span class="nn">gwsnr</span> <span class="kn">import</span> <span class="n">GWSNR</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li><p>let’s look at the input and output of ‘pdet’ calculator</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">snr_</span> <span class="o">=</span> <span class="n">GWSNR</span><span class="p">(</span><span class="n">gwsnr_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pdet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
psds not given. Choosing bilby&#39;s default psds
Interpolator will be loaded for L1 detector from ./interpolator_pickle/L1/partialSNR_dict_0.pickle
Interpolator will be loaded for H1 detector from ./interpolator_pickle/H1/partialSNR_dict_0.pickle
Interpolator will be loaded for V1 detector from ./interpolator_pickle/V1/partialSNR_dict_0.pickle
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialization pdet calculator</span>
<span class="n">pdet_calculator</span> <span class="o">=</span> <span class="n">snr_</span><span class="o">.</span><span class="n">snr</span>

<span class="c1"># test</span>
<span class="n">pdet_calculator</span><span class="p">(</span>
    <span class="n">gw_param_dict</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">mass_1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.0</span><span class="p">]),</span>
        <span class="n">mass_2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.0</span><span class="p">]),</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;L1&#39;: array([1]), &#39;H1&#39;: array([1]), &#39;V1&#39;: array([1]), &#39;pdet_net&#39;: array([1])}
</pre></div></div>
</div>
<p><strong>Note:</strong> pdet function has input==&gt;’gw_param_dict’ and output==&gt;’pdet_net’.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ler</span> <span class="o">=</span> <span class="n">GWRATES</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pdet_finder</span><span class="o">=</span><span class="n">pdet_calculator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gw_param</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_cbc_statistics</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Simulated GW params will be stored in ./ler_data/gw_param.json
chosen batch size = 50000 with total size = 100000
There will be 2 batche(s)
Batch no. 1
sampling gw source params...
calculating pdet...
Batch no. 2
sampling gw source params...
calculating pdet...
saving all gw_params in ./ler_data/gw_param.json...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gw_param</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;zs&#39;, &#39;geocent_time&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;phase&#39;, &#39;psi&#39;, &#39;theta_jn&#39;, &#39;luminosity_distance&#39;, &#39;mass_1_source&#39;, &#39;mass_2_source&#39;, &#39;mass_1&#39;, &#39;mass_2&#39;, &#39;L1&#39;, &#39;H1&#39;, &#39;V1&#39;, &#39;pdet_net&#39;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">,</span> <span class="n">gw_param_detectable</span> <span class="o">=</span> <span class="n">ler</span><span class="o">.</span><span class="n">gw_rate</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
getting gw_params from json file ./ler_data/gw_param.json...
given detectability_condition == &#39;pdet&#39;
total gw rate (yr^-1) (with step function): 460.67688974549634
number of simulated gw detectable events: 445
number of all simulated gw events: 100000
storing detectable gw params in ./ler_data/gw_param.json
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="LeR%20complete%20examples.html" class="btn btn-neutral float-left" title="LeR complete examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="grb%20detection%20rate.html" class="btn btn-neutral float-right" title="Calculation of detectable Gamma ray burst (GRB) event rate associated with Binary Neutron Star (BNS) mergers." accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Phurailatpam Hemantakumar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>